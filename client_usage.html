<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Waltham: Client API Usage</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Waltham
   &#160;<span id="projectnumber">0.1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Client API Usage </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>How to use the client API while following the example code</p>
<p>References to functions in <a class="el" href="client-api-example_8c-example.html">client-api-example.c</a> are in square brackets. See <a class="el" href="group__api__client.html">Client API</a> for a summary of the available API.</p>
<p>A client starts by calling <a class="el" href="group__api__client.html#ga92558808e3c20da42ed44fc2d540da07" title="Connect to a remote Waltham server. ">wth_connect_to_server()</a> to create a <a class="el" href="classwth__connection.html" title="A Waltham connection. ">wth_connection</a> <code></code>[main]. Alternatively, it is also possible to create the TCP connection by other means and pass the socket file descriptor to <a class="el" href="group__api__common.html#gaf13c012b0d11379986ad71553061b81a" title="Use an already connected socket. ">wth_connection_from_fd()</a> with <a class="el" href="waltham-connection_8h.html#a0860bddeb5bb7253a0474b557a5ca2d4a9a7e9ec71b5415eae1a65bbd7a29069c" title="Client-side object. ">WTH_CONNECTION_SIDE_CLIENT</a>.</p>
<p>The file descriptor of a new <a class="el" href="classwth__connection.html" title="A Waltham connection. ">wth_connection</a> needs to be polled for events <code></code>[main]. Use <a class="el" href="group__api__common.html#ga842cca1f1ccb767bea5bd086e035194b" title="Get connection file descriptor. ">wth_connection_get_fd()</a> to fetch the connection file descriptor and add it in your poll set for <code>POLLIN</code>. (The example also fetches the wth_display for the connection and sets the implementation, but this should be done by Waltham under the hood.)</p>
<p>The <a class="el" href="classwth__connection.html" title="A Waltham connection. ">wth_connection</a> file descriptor must be serviced as follows <code></code>[connection_handle_data]:</p>
<ul>
<li><code>POLLERR</code> and <code>POLLHUP:</code> the connection has died and resources need to be cleaned up.</li>
</ul>
<ul>
<li><code>POLLOUT:</code> The client explicitly polled for <code>POLLOUT</code> because an earlier call to <a class="el" href="group__api__common.html#ga3c1b4b75fb3b943167d911a00961a111" title="Flush buffered messages to the network. ">wth_connection_flush()</a> returned with failure <code>EAGAIN</code>. Now call <a class="el" href="group__api__common.html#ga3c1b4b75fb3b943167d911a00961a111" title="Flush buffered messages to the network. ">wth_connection_flush()</a> again. If it succeeds, stop polling for <code>POLLOUT</code>. If it fails with <code>EAGAIN</code>, continue polling for <code>POLLOUT</code>.</li>
</ul>
<ul>
<li><code>POLLIN:</code> The client must read incoming data into a buffer in <a class="el" href="classwth__connection.html" title="A Waltham connection. ">wth_connection</a> by calling <a class="el" href="group__api__common.html#gae4108a4f13e0d52e054826afda23b17b" title="Read data received from the network. ">wth_connection_read()</a>. Once the client is ready to process the read messages, it must call <a class="el" href="group__api__common.html#gabe1b48fb7be58159f6f98c8dc2b61e1f" title="Dispatch incoming messages. ">wth_connection_dispatch()</a> <code></code>[mainloop].</li>
</ul>
<p>Requests sent to a server are not guaranteed to be sent out to the network automatically, the client needs to call <a class="el" href="group__api__common.html#ga3c1b4b75fb3b943167d911a00961a111" title="Flush buffered messages to the network. ">wth_connection_flush()</a> explicitly <code></code>[mainloop], preferably just before sleeping on <code>poll</code>.</p>
<p>Protocol-wise, the first thing to do is to create a wthp_registry <code></code>[main]. Once the server processes the creation, it will send events for each global interface it supports. An easy way to guarantee that the client has seen all such advertisements is to call <a class="el" href="group__api__client.html#ga402f82228a650f0c93ebf8fb4bcbcb0c" title="Make a roundtrip from a client. ">wth_connection_roundtrip()</a>. Often binding to the global interfaces happens already in the wthp_registry event handler <code></code>[registry_handle_global]. Eventually the client enters its main loop <code></code>[main, mainloop].</p>
<p>If the client causes an error in the server, the server will send an error event. This sets the <a class="el" href="classwth__connection.html" title="A Waltham connection. ">wth_connection</a> into an error state <code></code>[not_here_error] and no more events will be dispatched. Instead, <a class="el" href="group__api__common.html#gabe1b48fb7be58159f6f98c8dc2b61e1f" title="Dispatch incoming messages. ">wth_connection_dispatch()</a> will fail with <code>EPROTO</code>. The client should clean up and call <a class="el" href="group__api__common.html#gadb62b719598fd0d1f7242a9c003be263" title="Disconnect. ">wth_connection_destroy()</a> to tear down the connection.</p>
<p>The client is reponsible for cleaning up all the resources. Even though <a class="el" href="classwth__connection.html" title="A Waltham connection. ">wth_connection</a> keeps track of protocol object IDs and <a class="el" href="classwth__object.html" title="A generic Waltham protocol object representation (a proxy) ">wth_object</a> instances, it does not automatically free them. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
