<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Waltham: wth_connection Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Waltham
   &#160;<span id="projectnumber">0.1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">wth_connection Class Reference<div class="ingroups"><a class="el" href="group__api__server.html">Server API</a> &#124; <a class="el" href="group__api__client.html">Client API</a> &raquo; <a class="el" href="group__api__common.html">Common API for both server and client</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>A Waltham connection.  
 <a href="classwth__connection.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="waltham-connection_8h_source.html">waltham-connection.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:ga4fc249eb0c3c36a12d7014cd02c5cc6a"><td class="memItemLeft" align="right" valign="top">typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__api__server.html#ga4fc249eb0c3c36a12d7014cd02c5cc6a">wth_registry_callback_func</a>) (struct wthp_registry *registry, void *user_data)</td></tr>
<tr class="memdesc:ga4fc249eb0c3c36a12d7014cd02c5cc6a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prototype of the callback to be called whenever a client creates a registry.  <a href="group__api__server.html#ga4fc249eb0c3c36a12d7014cd02c5cc6a">More...</a><br /></td></tr>
<tr class="separator:ga4fc249eb0c3c36a12d7014cd02c5cc6a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ga92558808e3c20da42ed44fc2d540da07"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="classwth__connection.html">wth_connection</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__api__client.html#ga92558808e3c20da42ed44fc2d540da07">wth_connect_to_server</a> (const char *host, const char *port)</td></tr>
<tr class="memdesc:ga92558808e3c20da42ed44fc2d540da07"><td class="mdescLeft">&#160;</td><td class="mdescRight">Connect to a remote Waltham server.  <a href="group__api__client.html#ga92558808e3c20da42ed44fc2d540da07">More...</a><br /></td></tr>
<tr class="separator:ga92558808e3c20da42ed44fc2d540da07"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9073b3086e003ba09ec15c7b142a4140"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="classwth__connection.html">wth_connection</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__api__server.html#ga9073b3086e003ba09ec15c7b142a4140">wth_accept</a> (int sockfd, struct sockaddr *addr, socklen_t *addrlen)</td></tr>
<tr class="memdesc:ga9073b3086e003ba09ec15c7b142a4140"><td class="mdescLeft">&#160;</td><td class="mdescRight">Accept a Waltham client connection.  <a href="group__api__server.html#ga9073b3086e003ba09ec15c7b142a4140">More...</a><br /></td></tr>
<tr class="separator:ga9073b3086e003ba09ec15c7b142a4140"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf13c012b0d11379986ad71553061b81a"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="classwth__connection.html">wth_connection</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__api__common.html#gaf13c012b0d11379986ad71553061b81a">wth_connection_from_fd</a> (int fd, enum <a class="el" href="waltham-connection_8h.html#a0860bddeb5bb7253a0474b557a5ca2d4">wth_connection_side</a> side)</td></tr>
<tr class="memdesc:gaf13c012b0d11379986ad71553061b81a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Use an already connected socket.  <a href="group__api__common.html#gaf13c012b0d11379986ad71553061b81a">More...</a><br /></td></tr>
<tr class="separator:gaf13c012b0d11379986ad71553061b81a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga842cca1f1ccb767bea5bd086e035194b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__api__common.html#ga842cca1f1ccb767bea5bd086e035194b">wth_connection_get_fd</a> (struct <a class="el" href="classwth__connection.html">wth_connection</a> *conn)</td></tr>
<tr class="memdesc:ga842cca1f1ccb767bea5bd086e035194b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get connection file descriptor.  <a href="group__api__common.html#ga842cca1f1ccb767bea5bd086e035194b">More...</a><br /></td></tr>
<tr class="separator:ga842cca1f1ccb767bea5bd086e035194b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadb62b719598fd0d1f7242a9c003be263"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__api__common.html#gadb62b719598fd0d1f7242a9c003be263">wth_connection_destroy</a> (struct <a class="el" href="classwth__connection.html">wth_connection</a> *conn)</td></tr>
<tr class="memdesc:gadb62b719598fd0d1f7242a9c003be263"><td class="mdescLeft">&#160;</td><td class="mdescRight">Disconnect.  <a href="group__api__common.html#gadb62b719598fd0d1f7242a9c003be263">More...</a><br /></td></tr>
<tr class="separator:gadb62b719598fd0d1f7242a9c003be263"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3c1b4b75fb3b943167d911a00961a111"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__api__common.html#ga3c1b4b75fb3b943167d911a00961a111">wth_connection_flush</a> (struct <a class="el" href="classwth__connection.html">wth_connection</a> *conn)</td></tr>
<tr class="memdesc:ga3c1b4b75fb3b943167d911a00961a111"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flush buffered messages to the network.  <a href="group__api__common.html#ga3c1b4b75fb3b943167d911a00961a111">More...</a><br /></td></tr>
<tr class="separator:ga3c1b4b75fb3b943167d911a00961a111"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae4108a4f13e0d52e054826afda23b17b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__api__common.html#gae4108a4f13e0d52e054826afda23b17b">wth_connection_read</a> (struct <a class="el" href="classwth__connection.html">wth_connection</a> *conn)</td></tr>
<tr class="memdesc:gae4108a4f13e0d52e054826afda23b17b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read data received from the network.  <a href="group__api__common.html#gae4108a4f13e0d52e054826afda23b17b">More...</a><br /></td></tr>
<tr class="separator:gae4108a4f13e0d52e054826afda23b17b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabe1b48fb7be58159f6f98c8dc2b61e1f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__api__common.html#gabe1b48fb7be58159f6f98c8dc2b61e1f">wth_connection_dispatch</a> (struct <a class="el" href="classwth__connection.html">wth_connection</a> *conn)</td></tr>
<tr class="memdesc:gabe1b48fb7be58159f6f98c8dc2b61e1f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Dispatch incoming messages.  <a href="group__api__common.html#gabe1b48fb7be58159f6f98c8dc2b61e1f">More...</a><br /></td></tr>
<tr class="separator:gabe1b48fb7be58159f6f98c8dc2b61e1f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga402f82228a650f0c93ebf8fb4bcbcb0c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__api__client.html#ga402f82228a650f0c93ebf8fb4bcbcb0c">wth_connection_roundtrip</a> (struct <a class="el" href="classwth__connection.html">wth_connection</a> *conn)</td></tr>
<tr class="memdesc:ga402f82228a650f0c93ebf8fb4bcbcb0c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Make a roundtrip from a client.  <a href="group__api__client.html#ga402f82228a650f0c93ebf8fb4bcbcb0c">More...</a><br /></td></tr>
<tr class="separator:ga402f82228a650f0c93ebf8fb4bcbcb0c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae088971a3c3ea3ed63cc9875fd4f751b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__api__common.html#gae088971a3c3ea3ed63cc9875fd4f751b">wth_connection_get_error</a> (struct <a class="el" href="classwth__connection.html">wth_connection</a> *conn)</td></tr>
<tr class="memdesc:gae088971a3c3ea3ed63cc9875fd4f751b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the connection error state.  <a href="group__api__common.html#gae088971a3c3ea3ed63cc9875fd4f751b">More...</a><br /></td></tr>
<tr class="separator:gae088971a3c3ea3ed63cc9875fd4f751b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga93db72bc2f462d21fa283f024e189e85"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__api__common.html#ga93db72bc2f462d21fa283f024e189e85">wth_connection_get_protocol_error</a> (struct <a class="el" href="classwth__connection.html">wth_connection</a> *conn, const char **interface, uint32_t *object_id)</td></tr>
<tr class="memdesc:ga93db72bc2f462d21fa283f024e189e85"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return protocol error details.  <a href="group__api__common.html#ga93db72bc2f462d21fa283f024e189e85">More...</a><br /></td></tr>
<tr class="separator:ga93db72bc2f462d21fa283f024e189e85"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga71482299a4e8a68a8a1f3c5b574d10ab"><td class="memItemLeft" align="right" valign="top">struct wthp_registry *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__api__client.html#ga71482299a4e8a68a8a1f3c5b574d10ab">wth_connection_create_registry</a> (struct <a class="el" href="classwth__connection.html">wth_connection</a> *conn)</td></tr>
<tr class="memdesc:ga71482299a4e8a68a8a1f3c5b574d10ab"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates a new registry using the internal wth_display.  <a href="group__api__client.html#ga71482299a4e8a68a8a1f3c5b574d10ab">More...</a><br /></td></tr>
<tr class="separator:ga71482299a4e8a68a8a1f3c5b574d10ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga61f841e989c611a23220b710ff62da43"><td class="memItemLeft" align="right" valign="top">struct wthp_callback *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__api__client.html#ga61f841e989c611a23220b710ff62da43">wth_connection_sync</a> (struct <a class="el" href="classwth__connection.html">wth_connection</a> *conn)</td></tr>
<tr class="memdesc:ga61f841e989c611a23220b710ff62da43"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return a callback using the internal wth_display.  <a href="group__api__client.html#ga61f841e989c611a23220b710ff62da43">More...</a><br /></td></tr>
<tr class="separator:ga61f841e989c611a23220b710ff62da43"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaca96980a0350051d95d53a7e485c673f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__api__server.html#gaca96980a0350051d95d53a7e485c673f">wth_connection_set_registry_callback</a> (struct <a class="el" href="classwth__connection.html">wth_connection</a> *conn, <a class="el" href="group__api__server.html#ga4fc249eb0c3c36a12d7014cd02c5cc6a">wth_registry_callback_func</a> registry_callback, void *user_data)</td></tr>
<tr class="memdesc:gaca96980a0350051d95d53a7e485c673f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the callback to be called once a client creates a registry.  <a href="group__api__server.html#gaca96980a0350051d95d53a7e485c673f">More...</a><br /></td></tr>
<tr class="separator:gaca96980a0350051d95d53a7e485c673f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga02300d71bc208f5e87ffa062427aa8bf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__api__server.html#ga02300d71bc208f5e87ffa062427aa8bf">wth_connection_post_error_no_memory</a> (struct <a class="el" href="classwth__connection.html">wth_connection</a> *conn)</td></tr>
<tr class="memdesc:ga02300d71bc208f5e87ffa062427aa8bf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Post an out of memory display error.  <a href="group__api__server.html#ga02300d71bc208f5e87ffa062427aa8bf">More...</a><br /></td></tr>
<tr class="separator:ga02300d71bc208f5e87ffa062427aa8bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>A Waltham connection. </p>
<p>This represents the TCP connection carrying Waltham messages.</p>
<p>A Waltham client creates a <a class="el" href="classwth__connection.html" title="A Waltham connection. ">wth_connection</a> with <a class="el" href="group__api__client.html#ga92558808e3c20da42ed44fc2d540da07" title="Connect to a remote Waltham server. ">wth_connect_to_server()</a>. A Waltham server creates a <a class="el" href="classwth__connection.html" title="A Waltham connection. ">wth_connection</a> with <a class="el" href="group__api__server.html#ga9073b3086e003ba09ec15c7b142a4140" title="Accept a Waltham client connection. ">wth_accept()</a>.</p>
<p>You set up polling with the help of <a class="el" href="group__api__common.html#ga842cca1f1ccb767bea5bd086e035194b" title="Get connection file descriptor. ">wth_connection_get_fd()</a>. When the fd becomes readable, you call <a class="el" href="group__api__common.html#gae4108a4f13e0d52e054826afda23b17b" title="Read data received from the network. ">wth_connection_read()</a> followed by <a class="el" href="group__api__common.html#gabe1b48fb7be58159f6f98c8dc2b61e1f" title="Dispatch incoming messages. ">wth_connection_dispatch()</a>.</p>
<p>After you have sent protocol messages, <a class="el" href="group__api__common.html#ga3c1b4b75fb3b943167d911a00961a111" title="Flush buffered messages to the network. ">wth_connection_flush()</a> must be called to flush the messages to the network before you wait for incoming messages.</p>
<p>A server should not destroy a <a class="el" href="classwth__connection.html" title="A Waltham connection. ">wth_connection</a> before the client has closed it, so that the TCP TIME_WAIT state is left on the client system. In case of a protocol error, the server should call <a class="el" href="group__api__server.html#gaee85b8a6fbf6bedcb607e018fc13f764" title="Post a fatal protocol error to a client. ">wth_object_post_error()</a> and wait for the client to disconnect.</p>
<p>A client should do one final roundtrip before destroying a <a class="el" href="classwth__connection.html" title="A Waltham connection. ">wth_connection</a> to ensure that all sent events have reached the server.</p>
<p>Once the connection goes into error state due to remote timeout, disconnect, Waltham protocol error, or any other reason, the various functions will start returning appropriate errors as described in each of them.</p>
<p>When the connection is specifically in protocol error state:</p><ul>
<li>reading will discard all incoming data</li>
<li>dispatching will discard all pending messages and not dispatch</li>
<li>sending messages still works</li>
<li>flush still works The protocol error state is only returned from <a class="el" href="group__api__common.html#gabe1b48fb7be58159f6f98c8dc2b61e1f" title="Dispatch incoming messages. ">wth_connection_dispatch()</a>, other functions will silently succeed unless there are further errors. </li>
</ul>
<dl><dt><b>Examples: </b></dt><dd><a class="el" href="client-api-example_8c-example.html#_a0">client-api-example.c</a>, and <a class="el" href="server-api-example_8c-example.html#_a0">server-api-example.c</a>.</dd>
</dl></div><hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="waltham-connection_8h_source.html">waltham-connection.h</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
